{"version":3,"sources":["../../src/pages/homedetails/homedetails.module.ts","../../src/pages/homedetails/homedetails.ts"],"names":[],"mappings":"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","file":"11.main.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { HomedetailsPage } from './homedetails';\n\n@NgModule({\n  declarations: [\n    HomedetailsPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(HomedetailsPage),\n  ],\n  exports: [\n    HomedetailsPage\n  ]\n})\nexport class HomedetailsPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/homedetails/homedetails.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, Events, ToastController  } from 'ionic-angular';\n\nimport { AngularFireDatabase, FirebaseListObservable } from \"angularfire2/database\";\nimport { BarcodeScanner } from '@ionic-native/barcode-scanner';\nimport { AlertController } from 'ionic-angular';\nimport { Storage } from '@ionic/storage';\nimport { PushNotification } from \"../../services/push-notification.service\";\n\nimport firebase from 'firebase';\n\n/**\n * Generated class for the HomedetailsPage page.\n *\n * See http://ionicframework.com/docs/components/#navigation for more info\n * on Ionic pages and navigation.\n */\n@IonicPage()\n@Component({\n  selector: 'page-homedetails',\n  templateUrl: 'homedetails.html',\n})\nexport class HomedetailsPage {\n\n  userData: any;\n  businessUserData: any;\n  barcodeDataText: any;\n  productBuyer: any;\n  userBuyerId: any;\n  paymentAlertBox: any;\n  slideData: any;\n  menuItem: any = [];\n  user: any;\n  points: any;\n  scanBool: any = false;\n\n  public callPhoneNumber: any;\n  public callAlternateNumbare: any;\n  public mailToEmail: any;\n\n  constructor(private toastCtrl: ToastController, private pushNotif: PushNotification, private event: Events, private storage: Storage, private alertCtrl: AlertController, private af: AngularFireDatabase, public navCtrl: NavController, public navParams: NavParams, private barcodeScanner: BarcodeScanner) {\n  }\n\n  public ngOnInit() {\n    console.log('Nav Params Items', this.navParams.get('navigateKey'));\n    let businessData = firebase.database().ref('/businessProfile/');\n    businessData.child(this.navParams.get('navigateKey')).once(\"value\", (snapshot) => {\n      this.userData = snapshot.val();\n      console.log('Snapshot Data', snapshot.val());\n      this.callPhoneNumber = 'tel:' + snapshot.val().phoneNumber;\n      this.callAlternateNumbare = 'tel:' + snapshot.val().alternateNumber;\n      this.mailToEmail = 'mailto:' + snapshot.val().email;\n      this.slideData = snapshot.val().bussinessImages;\n      this.menuItem = snapshot.val().menuList ? snapshot.val().menuList : [] ;\n    });\n    // this.user = this.af.object('/businessProfile/' + this.navParams.get('navigateKey'));\n\n    // this.user.subscribe((data) => {\n    //   this.userData = data;\n    //   this.callPhoneNumber = 'tel:' + data.phoneNumber;\n    //   this.callAlternateNumbare = 'tel:' + data.alternateNumber;\n    //   this.mailToEmail = 'mailto:' + data.email;\n    //   this.slideData = data.bussinessImages;\n    //   this.menuItem = data.menuList ? data.menuList : [] ;\n    // });\n\n    \n\n    this.storage.get('uid').then((response) => {\n      this.userBuyerId = response;\n      this.user = this.af.object('/userProfile/' + response);\n      this.user.subscribe((currentUser) => {\n        this.productBuyer = currentUser;\n        this.points = currentUser.points;\n    })\n    })\n  }\n\n  ionViewDidLoad() {\n    console.log('ionViewDidLoad HomedetailsPage');\n  }\n\n  jarvisMakeMeBold(name) {\n    return '<strong>' + name + '</strong>'\n  }\n\n  scanQrCode(menu: any) {\n    this.scanBool = true;\n    this.barcodeScanner.scan().then((barcodeData) => {\n      console.log('Jarvis Barcode Reply ==> ', barcodeData);\n      this.barcodeDataText = barcodeData.text;\n      if(this.barcodeDataText && this.barcodeDataText == this.navParams.get('navigateKey')) {\n        this.user = this.af.object('/businessProfile/' + barcodeData.text);\n        this.user.subscribe((data) => {\n          if(this.scanBool) {\n            console.log('Jarvis Business user info from barcode san data', data);\n            this.businessUserData = data;\n            this.paymentAlertBox = this.alertCtrl.create({\n              title: 'Confirm purchase',\n              message: 'Are you sure you want to pay ' + data.bussinessName + ' ' + menu.points + ' points for ' + this.jarvisMakeMeBold(menu.itemName) + '.',\n              cssClass: 'payment-alert',\n              buttons: [\n                {\n                  text: 'Cancel',\n                  role: 'cancel',\n                  handler: () => {\n                    console.log('Cancel clicked');\n                  }\n                },\n                {\n                  text: 'Buy',\n                  handler: () => {\n                    this.userConfirmToPay(menu);\n                  }\n                }\n              ]\n            });\n            this.paymentAlertBox.present();\n          }\n        });\n        // Success! Barcode data is here\n      } else {\n        let toast = this.toastCtrl.create({\n          message: 'Please scan a valid QR code to buy this product.',\n          duration: 2000,\n          position: 'middle'\n        });\n        toast.present();\n      }\n      \n       \n     }, (err) => {\n         // An error occurred\n     });\n  }\n\n  userConfirmToPay(currentMenu) {\n        this.points = this.points - currentMenu.points;\n        console.log('Updating user New points', this.points);\n        this.af.object('/userProfile/' + this.userBuyerId).update({points: this.points}).then(() => {\n          this.scanBool = false;\n          console.log('Inform business user');\n            this.af.object('/businessProfile/' + this.barcodeDataText).update({paymentSuccessUser: Object.assign(this.productBuyer, currentMenu)}).then((response) => {\n            console.log('Added user details who did the payment', response);\n            let alert = this.alertCtrl.create({\n              title: 'Payment Success',\n              message: 'Your current points are ' + this.points + '.',\n              buttons: ['OK']\n            });\n            alert.present();\n            this.ngOnInit();\n            }, (error)=> {\n                console.log('Failed Error ');\n            });\n        }, (error) => {\n          console.log('Error', error);\n            \n        });\n\n\n\n\n         // let message = {\n        //   \"username\": this.businessUserData.name,\n        //   \"registrationId\": this.businessUserData.registrationId,\n        //   \"type\": \"requestSpot\"\n        // }\n    \n        // console.log('Push notify MESSAGE ==>', message)\n        // this.pushNotif.sendPush(message).subscribe((response) => {\n        //   //alert(JSON.stringify(response));\n        //   console.log('Push notify SUCCESS ==>', JSON.stringify(response))\n        // },\n        //   (error) => {\n        //     console.log('Push notify ABC ERROR ==>', error);\n        //   })\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/homedetails/homedetails.ts"],"sourceRoot":""}