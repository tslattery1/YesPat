{"version":3,"sources":["../../src/pages/subscription/subscription.module.ts","../../src/pages/subscription/subscription.ts"],"names":[],"mappings":"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","file":"4.main.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { SubscriptionPage } from './subscription';\n\n@NgModule({\n  declarations: [\n    SubscriptionPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(SubscriptionPage),\n  ],\n})\nexport class SubscriptionPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/subscription/subscription.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, ToastController, MenuController, LoadingController } from 'ionic-angular';\nimport { Http, Headers } from '@angular/http';\nimport { InAppBrowser } from '@ionic-native/in-app-browser';\nimport { Auth } from \"../../providers/auth/auth\";\nimport { Storage } from '@ionic/storage';\nimport { Observable } from \"rxjs\";\nimport firebase from 'firebase';\nimport { FirebaseListObservable, AngularFireDatabase } from \"angularfire2/database\";\n\n\n\n@IonicPage()\n@Component({\n  selector: 'page-subscription',\n  templateUrl: 'subscription.html',\n})\nexport class SubscriptionPage {\n  public subscriptionType: any;\n  public userId: any;\n  public loader: any;\n\n  constructor(private loadingCtrl: LoadingController,private af: AngularFireDatabase,private iab: InAppBrowser, public menuCtrl: MenuController, private toastCtrl: ToastController, private http: Http, public navCtrl: NavController, public navParams: NavParams, private storage: Storage, private auth: Auth) {\n  }\n\n  public ngOnInit() {\n    this.menuCtrl.enable(false);\n    this.subscriptionType = this.navParams.get('subscriptionType');\n    this.userId = this.navParams.get('uid');\n  }\n\n  public logOutuser() {\n    console.log('logOut');\n    this.storage.clear();\n    this.auth.logoutUser()\n      .then(() => {\n        this.navCtrl.setRoot('LoginPage');\n        // this.app.getRootNav().setRoot('LoginPage');\n      })\n    localStorage.clear();\n  }\n\n  public subscribeUser() {\n    console.log('Jarvis subscribe this user');\n    this.loader = this.loadingCtrl.create({\n      content: 'Subscribing...'\n    });\n    this.loader.present();\n    let subscriptionType = this.subscriptionType == 'business' ? 'business' : 'user';\n    this.prepareRequest('http://yaspat.deapps.io:3002/users/create_plan', `type=${subscriptionType}`, 'post').subscribe((data) => {\n      let response = JSON.parse(data._body);\n      console.log('Create Plan Data', response);\n      if (response[0].statusCode == 200) {\n        let planID = response[0].value.plan_id;\n        console.log('Plan Id ', planID);\n        setTimeout(() => {\n          this.prepareRequest('http://yaspat.deapps.io:3002/users/create_agreement', `plan_id=${planID}`, 'post').subscribe((data) => {\n            let response = JSON.parse(data._body);\n            console.log('Create Agreement', response);\n            if (response[0].statusCode == 200) {\n              setTimeout(() => {\n                const browser = this.iab.create(response[0].value.approval_url, '_blank', 'location=yes');\n\n                browser.on('exit').subscribe(() => {\n                  console.log(1);\n                  this.prepareRequest('http://yaspat.deapps.io:3002/users/execute_agreement', `token=${response[0].value.token}`, 'post').subscribe((data) => {\n                    let tempAgreementID = JSON.parse(data._body);\n                    console.log('execute_agreement', tempAgreementID);\n                    if (tempAgreementID.statusCode == 200) {\n                      let agreementId = tempAgreementID.agreement_id;\n                      console.log('AgreementId', agreementId, this.userId);\n                      this.af.object('/userProfile/' + this.userId).update({ subscription: agreementId }).then(() => {\n                        if(this.loader) {\n                          this.loader.dismiss();\n                        }\n                        this.menuCtrl.enable(true);\n                        this.navCtrl.setRoot(this.subscriptionType == 'business' ? 'BussinessAddMenuPage' : 'PostFindspotPage');\n                      }, (error) => {\n                        if(this.loader) {\n                          this.loader.dismiss();\n                        }\n                        this.showToast();\n                      });\n                      // firebase.database().ref().child(this.userId).update({ subscription: agreementId }).then(() => {\n                      //   this.menuCtrl.enable(true, 'authenticated');\n                      //   this.navCtrl.setRoot('HomePage');\n                      // }, (error) => {\n                      //   this.showToast();\n                      // });\n                    } else {\n                      if(this.loader) {\n                        this.loader.dismiss();\n                      }\n                      this.showToast(tempAgreementID.message);\n                    }\n                  }, (error) => {\n                    if(this.loader) {\n                      this.loader.dismiss();\n                    }\n                    this.showToast();\n                  });\n                })\n              }, 1000);\n            } else {\n              if(this.loader) {\n                this.loader.dismiss();\n              }\n              this.showToast();\n            }\n          }, (error) => {\n            if(this.loader) {\n              this.loader.dismiss();\n            }\n            this.showToast();\n          });\n        }, 1000);\n      } else {\n        if(this.loader) {\n          this.loader.dismiss();\n        }\n        this.showToast(response.message);\n      }\n    }, (error) => {\n      if(this.loader) {\n        this.loader.dismiss();\n      }\n      this.showToast();\n    });\n  }\n\n  showToast(message?: any) {\n    let toast = this.toastCtrl.create({\n      message: message || 'Something went wrong.',\n      duration: 3000,\n      position: 'top'\n    });\n    toast.present();\n  }\n\n  prepareRequest(url, body, method) {\n    let options: any = {\n      url: url,\n      method: method,\n      headers: this.prepareHeaders(),\n      body: body\n    }\n\n    return this.http.request(url, options)\n      .map((res) => this.prepareData(res)).catch((error) => this.handleError(error));\n  }\n\n  private handleError(err: any) {\n    // console.log('handleError',err)\n    if (err) {\n      console.log('ERROR', err);\n\n      // Handled for cases where might be Api not able to response error message\n    }\n    return Observable.throw(2, err);\n  }\n\n  private prepareData(res: any) {\n    return res;\n  }\n\n  prepareHeaders() {\n    let headers = new Headers();\n    headers.append('Content-Type', 'application/x-www-form-urlencoded');\n    return headers;\n  }\n\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/subscription/subscription.ts"],"sourceRoot":""}